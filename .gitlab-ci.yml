stages:
  - build
  - codestyle

building:
  stage: build
  tags:
    - gitlab
  script:
    - apk add build-base
    - find $CI_PROJECT_DIR -name "Makefile" -execdir make \;
  artifacts:
    paths:
      - find $CI_PROJECT_DIR -name s21_cat -exec dirname {} \;
      - find $CI_PROJECT_DIR -name s21_grep -exec dirname {} \;
    expire_in: 30 days

stylecheck:
  stage: codestyle
  tags:
    - gitlab
  script:
    - apk add --upgrade clang-extra-tools build-base
    - output=$(clang-format -style="{$(grep $CI_PROJECT_DIR BasedOnStyle)}" -n $(find $CI_PROJECT_DIR -name *.[ch]))
    - if [ -n "$output" ]; then echo "$output" && exit 1; fi

